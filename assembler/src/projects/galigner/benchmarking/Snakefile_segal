# Edit config.yaml to add the paths before running
configfile: "config.yaml"
DATAPATH = config["datapath"]
GAPATH = config["gapath"]
GACFG = config["gacfg"] 

rule all:
    input:
        #expand(os.path.join(DATAPATH, "{org}/GAligner/output/aln_{reads}.tsv"), reads=["realnp", "simpb", "realpb"], org=["ecoli", "celegans"]),
        expand(os.path.join(DATAPATH, "{org}/GAligner/output/aln_{reads}.log"), reads=["realnp", "simpb", "realpb"], org=["ecoli", "celegans"])


rule prepare_cfg:
    output:
        "{DATAPATH}/{org}/GAligner/tmp/{reads}.yaml"
    run:
        print(wildcards.reads)
        if wildcards.reads.endswith("pb"):
           shell("python2 /home/tdvorkina/tmp/algorithmic-biology/assembler/src/projects/galigner/benchmarking/prepare_cfg.py {GACFG} {DATAPATH}/{wildcards.org}/input/graph.gfa {DATAPATH}/{wildcards.org}/input/{wildcards.reads}.fasta 77 pacbio > {output}")
        else:
           shell("python2 /home/tdvorkina/tmp/algorithmic-biology/assembler/src/projects/galigner/benchmarking/prepare_cfg.py {GACFG} {DATAPATH}/{wildcards.org}/input/graph.gfa {DATAPATH}/{wildcards.org}/input/{wildcards.reads}.fasta 77 nanopore > {output}")

rule run_aligner:
    input:
        "{DATAPATH}/{org}/SeGal/tmp/{reads}.yaml"
    output:
        tsv = "{DATAPATH}/{org}/SeGal/output/aln_{reads}.tsv",
        log = "{DATAPATH}/{org}/SeGal/output/aln_{reads}.log"
    benchmark:
        repeat("{DATAPATH}/{org}/SeGal/benchmark/align_{reads}.tsv", 3)
    shell:
        "{GAPATH} {input} -o {DATAPATH}/{wildcards.org}/SeGal/output/aln_{wildcards.reads} > {output.log}"







